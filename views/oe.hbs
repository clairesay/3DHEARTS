<body id="oe" class="common-structure">
    <header>
        <button id="returnToMenu" onclick="exitModule();">
            <img src="images/menu-heart.svg">
        </button>
    </header>
    <section id="navigation-tab">
        <a onclick="jumpSection('{{heartId}}' + '-oe.html', 'Case Details');">Case Details</a>
        <a onclick="jumpSection('{{heartId}}' + '-interaction.html', 'Exploration');">Exploration</a>
        <a onclick="jumpSection('{{heartId}}' + '-explanation.html', 'Explanation');">Explanation</a>
    </section>

    <section id="content-half">
        <div id="module-name">
            <h1>{{name}}'s Story</h1>
            <h3>Case Details</h3>
            <img class="profile" src="images/photos/{{toLowerCase name}}-recrop.png">
        </div>

        <div class="text-content-wrapper">
            <section class="content module-slide">
                {{#if (nameCheck name "Ben")}}
                <p>Ben is a 3-month old infant…</p>
                {{/if}}
                {{#if (nameCheck name "Ayanthi")}}
                <p></p>
                {{/if}}
                {{#if (nameCheck name "Amin")}}
                <p></p>
                {{/if}}
                {{#if (nameCheck name "Lucy")}}
                <p></p>
                {{/if}}
            </section>
            {{!-- <section class="content module-slide">
            <p>Let's look at the case of {{name}} and a potential diagnosis of a congenital heart defect.</p>
            </section> --}}

            {{#each preliminary_information}}
            {{makeModuleSlides this ""}}
            {{/each}}

            {{#each background_history}}
            {{makeModuleSlides this "Background History"}}
            {{/each}}

            {{#each on_examination}}
            {{makeModuleSlides this "On Examination"}}
            {{/each}}

            {{#if progress}}
            {{#each progress}}
            {{makeModuleSlides this "Progress"}}
            {{/each}}
            {{/if}}


            <section class="content module-slide">
                    <h1 id="chest-XR-slide" class="case-content">This is {{name}}'s chest x-ray.</h1>
            </section>

            <section class="content module-slide">
                <div class="differential-highlight">
                    <img class="differential-diagnoses" src="images/illustrations/{{toLowerCase name}}-differential.svg" alt="thinking time">
                    <h4>What are your differential diagnoses?</h4>
                </div>
                <p class="case-content">Think carefully about your answer before you proceed to the next page.</p>
            </section>

            <section class="content module-slide">
                <div class="differential-highlight">
                    <img class="differential-diagnoses" src="images/illustrations/{{toLowerCase name}}-differential.svg" alt="thinking time">
                    <h4>What are your differential diagnoses?</h4>
                </div>
                {{#each differential_diagnoses}}
                {{list this}}
                {{/each}}
            </section>

            <section class="content module-slide">
                <p class="case-content">Now you can proceed to examine the 3D-printed model of {{name}}’s cardiac defects.</p>
            </section>
        </div>

        <article id="buttons-container">
            <button id="previous" class="nav-button" onclick="nextSlide(-1)">
                <svg width="33" height="29" viewBox="0 0 33 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M29.5305 26.2037L18 14.6731L29.5305 3.14258" />
                    <path d="M14.5305 26.2037L2.99997 14.6731L14.5305 3.14258" />
                </svg>
            </button>
            <button id="next" class="nav-button" onclick="nextSlide(1);">
                <svg width="63" height="29" viewBox="0 0 63 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 26.2037L14.5305 14.6731L3 3.14258" />
                    <path d="M18 26.2037L29.5305 14.6731L18 3.14258" />
                    <path d="M33 26.2037L44.5305 14.6731L33 3.14258" />
                    <path d="M48 26.2037L59.5305 14.6731L48 3.14258" />
                </svg>
            </button>
            <button id="next-module" class="text-button none" onclick="nextModule();">3D Model</button>
        </article>
    </section>

    <section id="image-half">
        <img class="story-illustration" src="images/illustrations/{{toLowerCase name}}-story.svg">
        {{!-- <img class="story-illustration" src="images/illustrations/ben-background-history.svg"> --}}
        <img class="chest-xr none" src={{xray}}>
    </section>
</body>

<script>
    //This is for the on-examination section of the module
    //////////////////////////////////////// COLOUR SWITCH //////////////////////////////////////
    switch ("{{name}}") {
        case "Ben":
            document.documentElement.style.setProperty("--module-colour", "#9B51E0")
            break
        case "Ayanthi":
            document.documentElement.style.setProperty("--module-colour", "#EB5757")
            break
        case "Amin":
            document.documentElement.style.setProperty("--module-colour", "#2F80ED")
            break
        case "Lucy":
            document.documentElement.style.setProperty("--module-colour", "#27AE60")
            break
        default:
            break
    }


    //function displayChestXR() {
        //console.log(!!document.getElementById('chest-XR-slide'))

       // var chestXRSlide = !!document.getElementById('chest-XR-slide');
        //var incorrectIsVisible = window.getComputedStyle(chestXRSlide, null).getPropertyValue('display');
        //if (chestXRSlide) {
          //  console.log('now')

        //}
    //}

    ////////////////// TOP LEFT EXIT MODULE ////////////////////
    //Warning to prevent user from accidentally leaving the module
    function exitModule() {
        Swal.fire({
            title: 'Leave Module?',
            text: 'You will be taken back to the Modules Homepage.',
            icon: 'warning',
            showCancelButton: true,
            cancelButtonText: 'Cancel',
            confirmButtonText: 'Leave',
            reverseButtons: true
        }).then((result) => {
            if (result.value) {
                window.location.href = "index.html";
            }
        })
    }

    /////////////////////////////////// NAVIGATION TAB  ////////////////////////////////
    //checking for the path name
    var path = window.location.pathname;
    var page = path.split("/").pop();

    //highlighting the text to show the current page displayed
    if (page.includes('oe')) {
        document.querySelectorAll('#navigation-tab a')[0].style.color = "black";
        document.querySelectorAll('#navigation-tab a')[0].style.fontWeight = "700";
        document.querySelectorAll('#navigation-tab a')[0].style.cursor = "default";
    } else if (page.includes('interaction')) {
        document.querySelectorAll('#navigation-tab a')[1].style.color = "black";
        document.querySelectorAll('#navigation-tab a')[1].style.fontWeight = "700";
        document.querySelectorAll('#navigation-tab a')[1].style.cursor = "default";
    } else if (page.includes('explanation')) {
        document.querySelectorAll('#navigation-tab a')[2].style.color = "black";
        document.querySelectorAll('#navigation-tab a')[2].style.fontWeight = "700";
        document.querySelectorAll('#navigation-tab a')[2].style.cursor = "default";
    }

    //If the user clicks on a different section to jump to, warn them before they jump to it
    function jumpSection(destination, sectionName) {
        if (destination == page) {
        } else {
            Swal.fire({
                title: 'Start ' + sectionName + '?',
                text: 'You will leave this section.',
                icon: 'warning',
                showCancelButton: true,
                cancelButtonText: 'Cancel',
                confirmButtonText: 'Start',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    window.location.href = destination;
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                }
            })
        }
    }

    ///////////////////////////////// AT THE END OF A MODULE ///////////////////////////
    //at the end of the module, automatically forward user to the next section
    function nextModule() {
        window.location.href = {{ heartId }} + "-interaction.html";
    }

    ////////// USING LOCAL STORAGE TO OFFSET IF USER NAVIGATES TO PREVIOUS SLIDE FIXING/////////////
    document.getElementById('previous').addEventListener('click', function pointViewCount() {
        localStorage.setItem('prevCurrentPoint', currentPoint);
    })

    /////////////////////////////////// PROGRESSION THROUGH SLIDES ///////////////////////////////
    let pointIncrement = 0;
    //function to show current slide
    function showSlide(currentSlide) {
        //if the current slide is the first one, hide the previous button and show the next button only
        if (currentSlide == 0) {
            document.getElementById('previous').style.visibility = "hidden"
            document.getElementById('next').style.visibility = "visible"
            //if the current slide is the second last one, show the next-module button, hide the next button and show the previous button
        } else if (currentSlide == (document.querySelectorAll('.module-slide').length - 1)) {
            document.getElementById('previous').style.visibility = "visible"
            document.getElementById('previous').style.display = "flex"
            document.getElementById('next-module').style.visibility = "visible"
            document.getElementById('next-module').style.display = "flex"
            document.getElementById('next').style.visibility = "hidden"
            document.getElementById('next').style.display = "none"
            //show both the previous and next buttons and hide the next-module button at all other times
        } else {
            document.getElementById('previous').style.visibility = "visible"
            document.getElementById('previous').style.display = "flex"
            document.getElementById('next').style.visibility = "visible"
            document.getElementById('next').style.display = "flex"
            document.getElementById('next-module').style.visibility = "hidden"
            document.getElementById('next-module').style.display = "none"
        }

        //show this slide a.k.a current slide
        var thisSlide = document.getElementsByClassName('module-slide')[currentSlide];
        thisSlide.style.display = "flex";
        var caseContent = document.querySelectorAll('.case-content');
        //if this slide contains a class called 'case-content' a.k.a a point in a slide
        //for (var i = 0; i < caseContent.length; i++) {
        //    if ((thisSlide.contains(caseContent[i])) && (true)) {
        //        //change the next button to show the next point
        //        document.getElementById('next').setAttribute("onclick", "nextPoint(1);")
        //    }
        //}
    }

    function showIllustration(slideNumber) {
        var switchIllustration = document.getElementsByClassName('story-illustration')[0];
        switch(slideNumber) {
            case 0 :
                switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-story.svg');
                break;
            case 1 :
                switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-background-history.svg');
                break;
            case 2 :
                switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-on-examine.svg');
                break;
            case 3 :
                switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-on-examine.svg');
                break;
            case 4 :
                if ("{{name}}" != "Lucy") {
                    switchIllustration.setAttribute('src', 'images/XRAY/{{toLowerCase name}}_XR.jpg');
                } else {
                    switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-on-examine.svg');
                }            
                //switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-chest-x-ray.svg');
                break;
            case 5 :
                if ("{{name}}" != "Lucy") {
                    switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-story.svg');
                } else {
                    switchIllustration.setAttribute('src', 'images/XRAY/{{toLowerCase name}}_XR.jpg');
                }      
  
                //switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-chest-x-ray.svg');
                break;
            case 7 :
                //switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-story.svg');
                //switchIllustration.setAttribute('src', 'images/illustrations/ben-chest-x-ray.svg');
                break;
            default :
                switchIllustration.setAttribute('src', 'images/illustrations/{{toLowerCase name}}-story.svg');
                break;
        }
    }

    //Progression through slides
    var currentSlide = 0;
    function nextSlide(n) {
        //hide the previous slide
        var previousSlide = document.getElementsByClassName('module-slide')[currentSlide];
        previousSlide.style.display = "none";
        //add or minus 1 to current slide, depending on previous or next button click
        currentSlide += n;

        //display the slide
        showSlide(currentSlide);
        showIllustration(currentSlide);
    }
    showSlide(currentSlide);

    /////////////////////////////////// PROGRESSION THROUGH POINT CONTENT /////////////////////////////

    //This both a progression and display function for showing each point in the module
    var currentPoint = 0;
    function nextPoint(n) {
        //x is the number of elements with the class case-content within the current slide
        var x = document.getElementsByClassName('module-slide')[currentSlide].querySelectorAll('.case-content').length;
        //Add or minus 1 to the current point, depending on previous or next button click
        currentPoint += n;
        pointIncrement++;
        var thisPoint = document.getElementsByClassName('case-content')[currentPoint];

        //if the current point is less than the number existing in this slide
        if (currentPoint < x) {
            //show it
            thisPoint.style.visibility = "visible";
            //if the points on this slide have already been displayed, add on the number to the current point count so that the it skips to the next slide
        } else if (localStorage.hasOwnProperty('prevCurrentPoint') == true) {
            currentPoint == (parseInt(localStorage.getItem('prevCurrentPoint')));
            document.getElementById('next').setAttribute("onclick", "nextSlide(1);");
            document.getElementById('next').click();
            localStorage.clear();
            currentPoint--;
            //if the current point is the maximum number of points in this slide, clear the class name, move on
        } else if (currentPoint == x) {
            for (let i = 0; i < currentPoint; i++) {
                document.getElementsByClassName('module-slide')[currentSlide].querySelectorAll('.case-content')[0].classList = "";
            }
            document.getElementById('next').click();
            document.getElementById('next').setAttribute("onclick", "nextSlide(1);");
            document.getElementById('next').click();
        } else {
            document.getElementById('next').setAttribute("onclick", "nextSlide(1);");
            document.getElementById('next').click();
            currentPoint = 0;
        }
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>